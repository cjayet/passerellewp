function getAjaxResponse(urlArticleCible,json_data,callback){removeNodeEverywhere(".result_push_cms"),$.ajax({method:"POST",url:urlArticleCible,cache:!1,dataType:"json",data:{data_optme:json_data},success:function(e){callback(e)},error:function(xhr,status,error){if(404==xhr.status)sweetAlert("Oops...","Error 404 not found in getAjaxResponse","error");else{var err=eval("("+xhr.responseText+")"),data=new Array;data.result="error",data.message="Ajax error --- "+err,callback(data)}}})}function removeClassEverywhere(e){$("."+e).each(function(){$(this).removeClass(e)})}function removeNodeEverywhere(e){$(e).each(function(){$(this).remove()})}function setMetaRobotsIfSearchEngineDisabled(e){0==e&&($("#easycontent-noindex").prop("checked",!0),$("#easycontent-noindex").attr("disabled",!0),$("#easycontent-nofollow").prop("checked",!1),$("#easycontent-nofollow").attr("disabled",!0),$("#alert_no_search_engines").css("display",""))}function loadTinyMCE(e){tinymce.init({selector:e,menubar:!1,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste code"],toolbar:"undo redo | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent",content_css:"//www.tinymce.com/css/codepen.min.css"})}function changeTinymceContent(e,t){tinymce.get(e).setContent(t)}function getTinymceContent(e){return tinymce.get(e).getContent()}function loadGridEditor(){removeNodeEverywhere(".result_push_cms"),setBoolContentUpdatedAndNotSaved(!1);var e=$("#form_load_grideditor"),t=e.next();t.removeClass().html("");var n=$("#url_cible").val();if(null!==n){var o={url_cible:n};o.action="load_post_content",o.id_post=$("#select_list_posts").val();var i=JSON.stringify(o,null,2);$("#container-easycontent").css("display","none"),""!=o.id_post?($("body").loading(),getAjaxResponse(n,i,function(t){$("body").loading("stop"),"success"==t.result?($("#container-easycontent").slideDown(),$("#easycontent-title").val(t.title),$("#easycontent-slug").val(t.slug),$("#easycontent-meta-description").val(t.meta_description),$("#easycontent-canonical-url").val(t.url_canonical),$("#easycontent-url").val(t.url),$("#easycontent-cms-link").attr("href",t.url),0==t.blog_public?setMetaRobotsIfSearchEngineDisabled(0):($("#alert_no_search_engines").css("display","none"),1==t.noindex?$("#easycontent-noindex").prop("checked",!0):$("#easycontent-noindex").prop("checked",!1),1==t.nofollow?$("#easycontent-nofollow").prop("checked",!0):$("#easycontent-nofollow").prop("checked",!1)),1==t.publish?$("#easycontent-publish").prop("checked",!0):$("#easycontent-publish").prop("checked",!1),$("#easycontent-short_description").length&&($("#easycontent-short_description").val(t.short_description),changeTinymceContent("easycontent-short_description",t.short_description)),$("#easycontent-meta-title").length&&$("#easycontent-meta-title").val(t.meta_title),easycontentGridInit(t.content,!1)):e.append('<div class="form-group result_push_cms"><div class="alert alert-danger">'+t.message+"</div></div>")})):e.append('<div class="form-group result_push_cms"><div class="alert alert-danger">Veuillez choisir un contenu</div></div>')}else t.removeClass().addClass("alert alert-info"),t.html("Veuillez choisir une page/article")}function easycontentGridInit(e,t){if(1==t)var n=$("#easycontent-grid").gridEditor("getHtml");else var n="";$("#content-grid").html('<div id="easycontent-grid">'+n+e+"</div>"),initDraggableDroppable(),$("#easycontent-grid").gridEditor({new_row_layouts:[[12],[6,6],[9,3],[3,9],[8,4],[4,8]],content_types:["tinymce"],tinymce:{config:{inline:!0,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu responsivefilemanager paste"],toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link responsivefilemanager image insertfile",image_advtab:!0,external_filemanager_path:"includes/filemanager/",filemanager_title:"Filemanager",external_plugins:{filemanager:"http://localhost/passerelle/includes/filemanager/plugin.min.js"},relative_urls:!1}}})}function dropAction(e,t,n){e.removeClass("placeholderdrop");var o="";if("h1"==t&&(o="<h1>Title h1</h1>",injectDropContent(e,o)),"h2"==t&&(o="<h2>Title h2</h2>",injectDropContent(e,o)),"h3"==t&&(o="<h3>Title h3</h3>",injectDropContent(e,o)),"image"==t){if(""!=n&&void 0!==n)var i=n;else var i="http://placehold.it/550x150";o='<img src="'+i+'" alt="" style="max-width:100%; height:auto;" />',injectDropContent(e,o)}"content"==t&&(o="",getAjaxResponse("index.php?ajax=getLoremIpsum",$(this).attr("data-select"),function(t){"success"==t.result&&(o=t.lorem,injectDropContent(e,o))}))}function injectDropContent(e,t){setBoolContentUpdatedAndNotSaved(!0),e.html('<div class="col-md-12 col-sm-12 col-xs-12 column easyContentAddRow">'+t+"</div>"),removeRowsPlaceholder(),easycontentGridInit("",!0)}function addEasycontentToolbarFromText(){var t;$(this);if(window.getSelection?t=window.getSelection():document.selection&&(t=document.selection.createRange()),""!==t.toString()){var n=parseInt(e.pageX+30),o=parseInt(e.pageY-15);$.get("views/blocs/js-tmpl/toolbar.html",function(e){var i=Math.floor(Math.random()*Math.pow(10,7))+1;e=$.tmpl(e,{toolbarid:"toolbar-easycontent-"+i,suggestid:"toolbar-suggest-"+i}).html(),$("body").append(e),$("#toolbar-easycontent-"+i).css({left:n,top:o}),$("#toolbar-easycontent-"+i).find(".glyphicon-search").attr("data-select",t.toString())})}}function easycontentToolbarAction(){var e=$(this),t=e.attr("data-action");"close"==t?e.closest(".toolbar-editor").remove():"search"==t&&getAjaxResponse("index.php?ajax=getLoremIpsum",$(this).attr("data-select"),function(e){"success"==e.result&&sweetAlert("Res",e.lorem)})}function initDraggableDroppable(){$(".ui-draggable").draggable({helper:"clone",cursor:"move",revertDuration:0,revert:!0,refreshPositions:!1,start:function(e,t){t.helper.data("dropped",!1),removeClassEverywhere("easyContentAddRow");var n='<div class="row placeholderdrop"><div class="col-md-12 col-sm-12 col-xs-12 column">&nbsp;</div></div>',o=$("#easycontent-grid").gridEditor("getHtml");$("#content-grid").html('<div id="easycontent-grid">'+o+"</div>"),0==$("#easycontent-grid .row").length?$("#easycontent-grid").append(n):$("#easycontent-grid .row").each(function(e){0==e&&$(this).before(n),$(this).after(n)}),initDroppablePlaceholder()},stop:function(e,t){0==t.helper.data("dropped")&&(removeRowsPlaceholder(),easycontentGridInit("",!0))}})}function initDroppablePlaceholder(){$(".placeholderdrop").droppable({accept:".ui-draggable",hoverClass:"placeholderdropHover",tolerance:"pointer",drop:function(e,t){t.helper.data("dropped",!0);var n=$(t.draggable).attr("data-action"),o=$(t.draggable).attr("src");dropAction($(this),n,o)}})}function removeRowsPlaceholder(){$(".placeholderdrop").each(function(){$(this).remove()})}function refreshImagesListInPost(){if(1==boolContentUpdatedAndNotSaved)sweetAlert("Res","NO REFRESH");else{var e=$("#easycontent-grid").gridEditor("getHtml"),t={grideditor_content:e},n=JSON.stringify(t,null,2);getAjaxResponse("index.php?ajax=getImagesInGridEditor",n,function(e){$("#image-list").empty(),"success"==e.result&&(e.images.length>0?$.each(e.images,function(e,t){$.get("views/blocs/js-tmpl/image_detail_contenu.html",function(e){e=$.tmpl(e,{url_image:t.src,alt_image:t.alt,title_image:t.title}).html(),$("#image-list").append(e)})}):$("#image-list").append('<div class="alert alert-info">Aucune image trouvée.</div>'))})}}function refreshLiensListInPost(){var e=$("#easycontent-grid").gridEditor("getHtml"),t={grideditor_content:e},n=JSON.stringify(t,null,2);getAjaxResponse("index.php?ajax=getLiensInGridEditor",n,function(e){$("#href-list").empty(),"success"==e.result&&(e.liens.length>0?$.each(e.liens,function(e,t){$.get("views/blocs/js-tmpl/href_detail_contenu.html",function(e){e=$.tmpl(e,{href_lien:t.href,rel_lien:t.rel,target_lien:t.target}).html(),$("#href-list").append(e)})}):$("#href-list").append('<div class="alert alert-info">Aucun lien trouvé.</div>'))})}function loadRandomDummyImage(){getAjaxResponse("index.php?ajax=getRandomDummyImage",$(this).attr("data-select"),function(e){"success"==e.result&&($("#draggable-random-images").empty(),e.images.length>0&&($.each(e.images,function(e,t){$("#draggable-random-images").append('<img src="'+t+'"  data-action="image" width="100%" class="btn btn-default ui-draggable ui-draggable-handle ui-sortable" />')}),initDraggableDroppable()))})}function loadAllPostsPages(){var e=$("#url_cible").val();$("#container-easycontent").css("display","none"),$("body").loading();var t={url_cible:e};t.action="load_posts_pages";var n=JSON.stringify(t,null,2);$("#select_list_posts").empty(),getAjaxResponse(e,n,function(e){if($("body").loading("stop"),"success"==e.result){if(e.arborescence.posts&&e.arborescence.posts.length>0){var t='<optgroup label="Posts">';$.each(e.arborescence.posts,function(e,n){t+='<option value="'+n.ID+'">'+n.post_title+" ["+n.post_status+"]</option>"}),t+="</optgroup>",$("#select_list_posts").append(t)}if(e.arborescence.pages&&e.arborescence.pages.length>0){var t='<optgroup label="Pages">';$.each(e.arborescence.pages,function(e,n){t+='<option value="'+n.ID+'">'+n.post_title+" ["+n.post_status+"]</option>"}),t+="</optgroup>",$("#select_list_posts").append(t)}$("#page_easycontenteditor_loadpage").slideDown(),$(".selectpicker").selectpicker("refresh")}else sweetAlert("Oops...","Error in loadAllPostsPages","error")}),$(document).on("change",".post_type",function(){var e=$("input[name=post_type]:checked").val();"page"==e?$("#liste-pages").slideDown():$("#liste-pages").slideUp()})}function updateUrlField(e){""!=e.url&&void 0!==e.url&&($("#easycontent-url").val(e.url),$("#easycontent-slug").val(e.new_slug))}function previewContentInCMS(e){var t=$("#easycontent-url").val(),n=e.closest("form"),o=$("#easycontent-grid").gridEditor("getHtml");$("#preview_content").attr("value",o),n.attr("action",t),n.submit()}function setBoolContentUpdatedAndNotSaved(e){if(1==e)var t="no-modal";else var t="modal";$("#btn_easycontent_optimiz_images").attr("data-toggle",t),$("#btn_easycontent_optimiz_hrefs").attr("data-toggle",t)}function actionOnBtnOptimisationImagesHrefs(e){"no-modal"==e.attr("data-toggle")?sweetAlert("Informations","Veuillez enregistrer le contenu pour avoir accès à cette fonctionnalité","warning"):e.hasClass("refresh_images")?refreshImagesListInPost():e.hasClass("refresh_links")&&refreshLiensListInPost()}function loadRedirectionsFromSite(){if(removeNodeEverywhere(".ligne_table_redirection"),$("#page-redirections").length>0){var e=$("#url_cible").val();$("body").loading();var t={url_cible:e};t.action="load_redirections";var n=JSON.stringify(t,null,2);getAjaxResponse(e,n,function(e){$("body").loading("stop"),"success"==e.result?e.redirections.length>0&&$("#redirection-table-ligne").tmpl(e).appendTo("#table-redirections tbody"):sweetAlert("Oops...","Error loading redirections","error")}),$("body").loading("stop")}}function shopifyLoadAllRedirections(){var e={shop_name:$("#url_cible").val()},t=JSON.stringify(e,null,2);$("body").loading(),getAjaxResponse("index.php?ajax=shopifyGetRedirections",t,function(e){$("body").loading("stop"),"success"==e.result?e.redirections.length>0&&$("#redirection-table-ligne").tmpl(e).appendTo("#table-redirections tbody"):sweetAlert("Oops...","Error loading redirections","error")})}var boolContentUpdatedAndNotSaved=!1;$(document).ready(function(){$(document).on("click",".push_cms",function(){var e=$(this),t=$(this).closest("form"),n=e.attr("data-url");if(void 0!==n&&""!=n)var o=n;else var o=$("#url_cible").val();console.log("push_cms TO "+o),""!=o?(t.loading(),t.each(function(){var n=$(this).find(":input"),i={url_cible:o};$("#select_list_posts").length?i.id_post=$("#select_list_posts").val():$("#shopify_select_list_products").length&&(i.id_post=$("#shopify_select_list_products").val()),n.each(function(){if("radio"==$(this).attr("type")||"checkbox"==$(this).attr("type"))$(this).prop("checked")&&(i[$(this).attr("data-id")]=$(this).val());else if("select"==$(this).attr("type"))$(this).prop("selected")&&(i[$(this).attr("data-id")]=$(this).find(":selected").val());else if(i[$(this).attr("data-id")]=$(this).val(),"action"==$(this).attr("data-id")&&"set_post_content"==$(this).val())i.new_content=$("#easycontent-grid").gridEditor("getHtml");else if("action"==$(this).attr("data-id")&&"set_post_shortdescription"==$(this).val()){var e=getTinymceContent("easycontent-short_description");i.new_short_description=e}else"action"==$(this).attr("data-id")&&"set_shopify_product_update"==$(this).val()&&(i.shop_name=$("#url_cible").val(),i.new_description=getTinymceContent("product_description"))});var a=JSON.stringify(i,null,2);getAjaxResponse(o,a,function(n){t.loading("stop");var o=e.attr("data-after");void 0!==o&&""!=o&&window[o](n),"set_post_content"==i.action&&"success"==n.result&&(setBoolContentUpdatedAndNotSaved(!1),easycontentGridInit(n.content,!1)),t.append('<div class="form-group result_push_cms"><div class="alert alert-'+n.result+'">'+n.message+"</div></div>")})})):sweetAlert("Oops...","No URL to perform ajax!","error")})}),$(document).ready(function(){$("#easycontent-short_description").length&&loadTinyMCE("#easycontent-short_description"),$(document).on("click",".load_grid_editor",function(){loadGridEditor()}),$(document).on("change","#select_list_posts",function(){loadGridEditor()}),$(document).on("click",".load_arborescence",function(){loadAllPostsPages()}),$(document).on("mouseup",".ge-content.active",function(e){addEasycontentToolbarFromText()}),$(document).on("click",".toolbar-menu-action span",function(){easycontentToolbarAction()}),$(document).on("click",".load_random_images",function(){loadRandomDummyImage()}),$(document).on("click",".preview_content",function(){previewContentInCMS($(this))}),$(document).on("click",".push_easycontent_cms",function(){setBoolContentUpdatedAndNotSaved(!1)}),$(document).on("click","#btn_easycontent_optimiz_images, #btn_easycontent_optimiz_hrefs",function(){actionOnBtnOptimisationImagesHrefs($(this))})}),$(document).on("click",".confirmAction",function(){var e=$(this);swal({title:"Are you sure?",text:"Do you really want to do this?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, just do it!",closeOnConfirm:!0},function(){var t=e.attr("data-url");if(void 0!==t&&""!=t)var n=t;else var n=$("#url_cible").val();var o={url_cible:n};o.action=e.attr("data-action"),o.id_redirection=e.attr("data-id");var i=e.attr("data-cms");void 0!==i&&"shopify"==i&&(o.shop_name=$("#url_cible").val());var a=JSON.stringify(o,null,2);getAjaxResponse(n,a,function(e){if("success"==e.result){var t=$("#table-redirections #redirection-"+o.id_redirection);"redirection_enable"==o.action&&t.removeClass("danger").addClass("success"),"redirection_disable"==o.action&&t.removeClass("success").addClass("danger"),"redirection_delete"==o.action&&t.remove()}else sweetAlert("Oops...","Error ajax","error")})})}),$(document).ready(function(){$(document).on("change",".createpostpage_post_type",function(){var e=$("input[name=post_type]:checked").val();"page"==e?$("#liste-pages").slideDown():$("#liste-pages").slideUp()}),$(document).on("click","#btn_createpostpage_loadarborescence",function(){var e=$("#url_cible").val();if($("#easycontent-url").val(e),""!=e){$("body").loading();var t={url_cible:"test"};t.action="load_posts_pages";var n=JSON.stringify(t,null,2);getAjaxResponse(e,n,function(e){$("body").loading("stop"),"success"==e.result?($("#select_post_parent").empty(),$("#select_post_parent").append('<option value="0">No parent</option>'),e.arborescence.pages.length>0&&$.each(e.arborescence.pages,function(e,t){$("#select_post_parent").append('<option value="'+t.ID+'">'+t.post_title+" ["+t.post_status+"]</option>")})):sweetAlert("Oops...","Error loading pages, please try again","error")})}})}),$(document).ready(function(){$(document).on("click","#load_site_options",function(){var e=$("#url_cible").val();if($("#easycontent-url").val(e),form=$(this).closest("form"),""!=e){var t={url_cible:e};t.action="load_site_options";var n=JSON.stringify(t,null,2);$("body").loading(),getAjaxResponse(e,n,function(e){"success"==e.result&&($("#easycontent_site_title").val(e.site_title),$("#easycontent_site_description").val(e.site_description),"1"==e.site_is_public?$("#nosearchengine").prop("checked",!1):$("#nosearchengine").prop("checked",!0)),$("body").loading("stop")})}})}),$(document).ready(function(){function e(){$("#container-shopify").css("display","none");var e={shop_name:$("#url_cible").val()},t=JSON.stringify(e,null,2);$("body").loading(),getAjaxResponse("index.php?ajax=shopifyGetProducts",t,function(e){if("success"==e.result){if($("#shopify_select_list_products").empty(),e.products.length>0){var t='<optgroup label="Products">';$.each(e.products,function(e,n){t+='<option value="'+n.id+'">'+n.title+"</option>"}),t+="</optgroup>",$("#shopify_select_list_products").append(t),$("body").loading("stop"),$("#page_easycontenteditor_loadpage").slideDown(),$(".selectpicker").selectpicker("refresh")}}else sweetAlert("Erreur ajax")})}function t(){$("#container-shopify").css("display","none");var e={shop_name:$("#url_cible").val(),id_product:$("#shopify_select_list_products").val()},t=JSON.stringify(e,null,2);$("body").loading(),getAjaxResponse("index.php?ajax=shopifyGetProduct",t,function(e){"success"==e.result&&($("#product_name").val(e.product.title),$("#product_handle").val(e.product.handle),$("#product_current_handle").val(e.product.handle),$("#product_metatitle").val(e.metas.meta_title),$("#product_metadescription").val(e.metas.meta_description),$("#product_description").val(e.product.body_html),changeTinymceContent("product_description",e.product.body_html),$("body").loading("stop"),$("#container-shopify").slideDown(),e.product.images.length>0?$.each(e.product.images,function(e,t){$.get("views/blocs/js-tmpl/shopify_image_detail_contenu.html",function(e){e=$.tmpl(e,{url_image:t.src,alt_image:t.src,title_image:t.src}).html(),$("#image-list").append(e)})}):$("#image-list").append('<div class="alert alert-info">Aucune image trouvée.</div>'))})}$("#product_description").length&&loadTinyMCE("#product_description"),$(document).on("click","#shopify_load_products",function(){e()}),$(document).on("click","#btn-load-shopify-product",function(){t()}),$(document).on("change","#shopify_select_list_products",function(){t()}),$(document).on("click","#shopify_load_redirections",function(){shopifyLoadAllRedirections()})});